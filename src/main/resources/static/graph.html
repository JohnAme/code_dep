<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="http://neo4j-contrib.github.io/developer-resources/language-guides/assets/css/main.css">
    <link rel="shortcut icon" href="#">
    <title>CDCGraph</title>
</head>


<div role="navigation" class="navbar navbar-default navbar-static-top">
    <div class="container">
        <div class="row">
            <div class="navbar-header col-sm-6 col-md-6">
                <div class="navbar-brand">
                    <div class="brand">Code Dependency Graph</div>
                </div>
            </div>
        </div>
    </div>
</div>
<body>

<div id="graph" role="presentation" class="main-container page right-side" style="offset-position: right">
</div>

<style type="text/css">
    .node { fill:lightgoldenrodyellow ;stroke: #aaa; stroke-width: 1px; }

    #codeCD{fill:#c7254e;stroke-width: 1}

    .link {
        fill: none;
        stroke: #666;
        stroke-width: 1.5px;
    }
    .link.directCD{ stroke: #c7254e; stroke-width:2; stroke-dasharray: 4}
    .link.dataCD{stroke: #1b809e;stroke-width:1.5 }

    text {
        font: 16px sans-serif;
        pointer-events: none;
        text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff;
    }
</style>

<script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="https://d3js.org/d3.v3.min.js"></script>

<script type="text/javascript">
    var width = 800, height = 800;

    var force = d3.layout.force()
        .charge(-2000).linkDistance(200).size([width, height]);

    var svg = d3.select("#graph").append("svg")
        .attr("width", "100%").attr("height", "100%")
        .attr("pointer-events", "all");

    d3.json("/trace/CDCGraph/javacg", function(error, graph) {
        if (error) return;

        force.nodes(graph.nodes).links(graph.links).start();

        svg.append("defs").selectAll("marker")
            .data(["dataCD", "directCD"])
            .enter().append("marker")
            .attr("id", function(d) { return d; })
            .attr("viewBox", "0 -5 7 10")
            .attr("refX", 10)
            .attr("refY", -1.5)
            .attr("markerWidth", 6)
            .attr("markerHeight", 6)
            .attr("orient", "auto")
            .append("path")
            .attr("d", "M0,-5L80,0L0,5");

        var path = svg.append("g").selectAll("path")
            .data(force.links())
            .enter().append("path")
            .attr("class", function(d) { return "link " + d.type; })
            .attr("marker-end", function(d) { return "url(#" + d.type + ")"; });
        path.append("title").text(d=>d.type+": "+d.closeness);

        var node = svg.selectAll(".node")
            .data(graph.nodes).enter()
            .append("circle")
            .attr("class", "node")
            .attr("r", 12)
            .call(force.drag);

        var text = svg.append("g").selectAll("text")
            .data(force.nodes())
            .enter().append("text")
            .attr("x", 12)
            .attr("y", ".31em")
            .text(function(d) { return d.name; });


        force.on("tick", function() {
            node.attr("cx", function(d) { return d.x; })
                .attr("cy", function(d) { return d.y; });
            text.attr("transform",function(d){
                return "translate(" + d.x + "," + d.y + ")";
            })
            path.attr("d",function(d){
                var dx = d.target.x - d.source.x,
                    dy = d.target.y - d.source.y,
                    dr = Math.sqrt(dx * dx + dy * dy);
                return "M" + d.source.x + "," + d.source.y + "A" + dr + "," + dr + " 0 0,1 " + d.target.x + "," + d.target.y;
            })
        });


    });
</script>
</body>
</html>
